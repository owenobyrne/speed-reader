---
phase: 03-file-handling
plan: 02
type: execute
---

<objective>
Implement web URL text extraction using Mozilla Readability, allowing users to paste or drop URLs to load articles into the RSVP reader.

Purpose: Enable users to read web articles by pasting URLs, extracting only the main article content (no navigation, ads, footers).
Output: URL input support that fetches web pages, extracts article text via Readability, and loads into RSVP display.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-file-handling/03-RESEARCH.md

# Prior plan in this phase:
@.planning/phases/03-file-handling/03-01-SUMMARY.md (will exist when this runs)

# Key files to modify:
@renderer.js

**Tech stack available:** electron@40, pdf-parse, mammoth
**From RESEARCH.md:**
- Use @mozilla/readability + jsdom for article extraction
- Readability automatically filters to main article content (no nav/headers/footers/ads)
- URL detection: try/catch new URL(str)
- Fetch in main process avoids CORS issues
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Readability and create URL parser</name>
  <files>package.json, preload.js</files>
  <action>
1. Install libraries:
   npm install @mozilla/readability jsdom

2. Update preload.js to add URL fetching capability:
   - Add fetchURL(url) function that:
     - Uses fetch() to get HTML (Node 18+ has native fetch)
     - Creates JSDOM with the HTML and url option
     - Uses Readability to parse and extract article
     - Returns article.textContent or throws if extraction fails
   - Expose via contextBridge: window.fileAPI.fetchURL(url)

3. Add URL validation helper to preload.js:
   - isURL(str) - returns true if valid URL (http/https)
   - Expose via contextBridge: window.fileAPI.isURL(str)
  </action>
  <verify>In dev console, window.fileAPI.isURL('https://example.com') returns true</verify>
  <done>Readability installed, preload exposes fetchURL and isURL functions</done>
</task>

<task type="auto">
  <name>Task 2: Integrate URL handling into drag-drop flow</name>
  <files>renderer.js, index.html</files>
  <action>
1. Update drop handler in renderer.js:
   - Check if dropped text (not file) is a URL using window.fileAPI.isURL()
   - For text drops: e.dataTransfer.getData('text/plain')
   - If URL detected: call window.fileAPI.fetchURL(url), then loadText() + play()

2. Add paste handler for URLs:
   - Listen for 'paste' event on document
   - Get text from e.clipboardData.getData('text/plain')
   - If URL: fetch and load into RSVP

3. Update instruction text in index.html to include "or paste URL"

4. Add loading state feedback:
   - Show "Loading..." in word-display while fetching URL
   - Handle fetch errors gracefully (alert user)
  </action>
  <verify>Paste a URL like https://example.com - should fetch and load content</verify>
  <done>URLs can be pasted or dropped, article text extracted and loaded into RSVP</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete file handling: drag-drop for PDF/Word files and paste/drop for web URLs</what-built>
  <how-to-verify>
    1. Run: npm start
    2. Test PDF: Drag a .pdf file onto the window - text should extract and RSVP playback begins
    3. Test Word: Drag a .docx file onto the window - text should extract and RSVP playback begins
    4. Test URL paste: Copy a URL (e.g., a Wikipedia article), paste into window (Ctrl/Cmd+V) - article text should load
    5. Test URL drop: Drag a URL from browser address bar onto window - should work like paste
    6. Test error: Drop an unsupported file (.jpg) - should show error message
    7. Confirm: RSVP display shows extracted text with ORP highlighting
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm start runs without errors
- [ ] PDF drag-drop works (from 03-01)
- [ ] Word drag-drop works (from 03-01)
- [ ] URL paste extracts article text
- [ ] URL drag-drop extracts article text
- [ ] Loading feedback shown during URL fetch
- [ ] Error handling for failed fetches
</verification>

<success_criteria>

- Readability and jsdom installed
- URL detection and validation working
- URL fetch extracts article content (main text only)
- Paste and drop both work for URLs
- All input methods (PDF, Word, URL, txt) working end-to-end
- Phase 3: File Handling complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-file-handling/03-02-SUMMARY.md`

Mark Phase 3 complete in ROADMAP.md and STATE.md
</output>
